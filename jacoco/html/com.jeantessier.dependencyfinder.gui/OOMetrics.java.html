<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>OOMetrics.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">code-coverage-report</a> &gt; <a href="index.source.html" class="el_package">com.jeantessier.dependencyfinder.gui</a> &gt; <span class="el_source">OOMetrics.java</span></div><h1>OOMetrics.java</h1><pre class="source lang-java linenums">/*
 *  Copyright (c) 2001-2025, Jean Tessier
 *  All rights reserved.
 *  
 *  Redistribution and use in source and binary forms, with or without
 *  modification, are permitted provided that the following conditions
 *  are met:
 *  
 *      * Redistributions of source code must retain the above copyright
 *        notice, this list of conditions and the following disclaimer.
 *  
 *      * Redistributions in binary form must reproduce the above copyright
 *        notice, this list of conditions and the following disclaimer in the
 *        documentation and/or other materials provided with the distribution.
 *  
 *      * Neither the name of Jean Tessier nor the names of his contributors
 *        may be used to endorse or promote products derived from this software
 *        without specific prior written permission.
 *  
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 *  &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 *  A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR
 *  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 *  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

package com.jeantessier.dependencyfinder.gui;

import com.jeantessier.commandline.CommandLine;
import com.jeantessier.commandline.CommandLineUsage;
import com.jeantessier.commandline.NullParameterStrategy;
import com.jeantessier.metrics.MetricsConfigurationLoader;
import com.jeantessier.metrics.MetricsFactory;
import org.apache.logging.log4j.*;

import javax.swing.*;
import javax.swing.border.BevelBorder;
import javax.swing.table.TableCellRenderer;
import javax.swing.text.JTextComponent;
import java.awt.*;
import java.awt.event.KeyEvent;
import java.io.File;

public class OOMetrics extends JFrame {
<span class="nc" id="L51">    private static final TableCellRenderer RENDERER = new MeasurementTableCellRenderer();</span>

    private MetricsFactory factory;

<span class="nc" id="L55">    private final JMenuBar menuBar = new JMenuBar();</span>
<span class="nc" id="L56">    private final JMenu fileMenu = new JMenu();</span>
<span class="nc" id="L57">    private final JMenu helpMenu = new JMenu();</span>
<span class="nc" id="L58">    private final JToolBar toolbar = new JToolBar();</span>
<span class="nc" id="L59">    private final JTextArea projectArea = new JTextArea();</span>
<span class="nc" id="L60">    private final JButton filterButton = new JButton(&quot;Filter:&quot;);</span>
<span class="nc" id="L61">    private final JTextField filterField = new JTextField(&quot;//&quot;);</span>
<span class="nc" id="L62">    private final StatusLine statusLine = new StatusLine(420);</span>
<span class="nc" id="L63">    private final JProgressBar progressBar = new JProgressBar();</span>

    private final OOMetricsTableModel groupsModel;
    private final OOMetricsTableModel classesModel;
    private final OOMetricsTableModel methodsModel;

<span class="nc" id="L69">    private File inputFile = new File(&quot;.&quot;);</span>

    private final boolean enableCrossClassMeasurements;

<span class="nc" id="L73">    public OOMetrics(MetricsFactory factory, boolean enableCrossClassMeasurements) {</span>
<span class="nc" id="L74">        this.factory = factory;</span>
<span class="nc" id="L75">        this.enableCrossClassMeasurements = enableCrossClassMeasurements;</span>

<span class="nc" id="L77">        this.setSize(new Dimension(800, 600));</span>
<span class="nc" id="L78">        this.setTitle(&quot;OO Metrics&quot;);</span>
<span class="nc" id="L79">        this.setIconImage(new ImageIcon(getClass().getResource(&quot;icons/logoicon.gif&quot;)).getImage());</span>
<span class="nc" id="L80">        this.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE);</span>
<span class="nc" id="L81">        this.addWindowListener(new WindowKiller());</span>

<span class="nc" id="L83">        groupsModel = new OOMetricsTableModel(factory.getConfiguration().getGroupMeasurements());</span>
<span class="nc" id="L84">        classesModel = new OOMetricsTableModel(factory.getConfiguration().getClassMeasurements());</span>
<span class="nc" id="L85">        methodsModel = new OOMetricsTableModel(factory.getConfiguration().getMethodMeasurements());</span>

<span class="nc" id="L87">        buildMenus();</span>
<span class="nc" id="L88">        buildUI();</span>

        try {
<span class="nc" id="L91">            UIManager.setLookAndFeel(&quot;javax.swing.plaf.metal.MetalLookAndFeel&quot;);</span>
<span class="nc" id="L92">            SwingUtilities.updateComponentTreeUI(this);</span>
<span class="nc" id="L93">        } catch (Exception ex) {</span>
<span class="nc" id="L94">            LogManager.getLogger(OOMetrics.class).error(&quot;Unable to set look and feel&quot;, ex);</span>
<span class="nc" id="L95">        }</span>

<span class="nc" id="L97">        statusLine.showInfo(&quot;Ready.&quot;);</span>
<span class="nc" id="L98">    }</span>

    MetricsFactory getMetricsFactory() {
<span class="nc" id="L101">        return factory;</span>
    }

    void setMetricsFactory(MetricsFactory factory) {
<span class="nc" id="L105">        this.factory = factory;</span>
<span class="nc" id="L106">    }</span>

    JTextArea getProjectArea() {
<span class="nc" id="L109">        return projectArea;</span>
    }

    OOMetricsTableModel getGroupsModel() {
<span class="nc" id="L113">        return groupsModel;</span>
    }

    OOMetricsTableModel getClassesModel() {
<span class="nc" id="L117">        return classesModel;</span>
    }

    OOMetricsTableModel getMethodsModel() {
<span class="nc" id="L121">        return methodsModel;</span>
    }

    File getInputFile() {
<span class="nc" id="L125">        return inputFile;</span>
    }

    void setInputFile(File inputFile) {
<span class="nc" id="L129">        this.inputFile = inputFile;</span>
<span class="nc" id="L130">    }</span>

    JTextComponent getFilterField() {
<span class="nc" id="L133">        return filterField;</span>
    }

    StatusLine getStatusLine() {
<span class="nc" id="L137">        return statusLine;</span>
    }

    JProgressBar getProgressBar() {
<span class="nc" id="L141">        return progressBar;</span>
    }

    public boolean isEnableCrossClassMeasurements() {
<span class="nc" id="L145">        return enableCrossClassMeasurements;</span>
    }

    private void buildMenus() {
<span class="nc" id="L149">        buildFileMenu();</span>
<span class="nc" id="L150">        buildHelpMenu();</span>

<span class="nc" id="L152">        this.setJMenuBar(menuBar);</span>
<span class="nc" id="L153">    }</span>

    private void buildFileMenu() {
<span class="nc" id="L156">        menuBar.add(fileMenu);</span>

<span class="nc" id="L158">        fileMenu.setText(&quot;File&quot;);</span>

        Action action;
        JMenuItem menuItem;
        JButton button;

<span class="nc" id="L164">        action = new MetricsExtractAction(this);</span>
<span class="nc" id="L165">        menuItem = fileMenu.add(action);</span>
<span class="nc" id="L166">        menuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_E, Event.CTRL_MASK));</span>
<span class="nc" id="L167">        menuItem.setMnemonic('e');</span>
<span class="nc" id="L168">        button = toolbar.add(action);</span>
<span class="nc" id="L169">        button.setToolTipText((String) action.getValue(Action.LONG_DESCRIPTION));</span>

<span class="nc" id="L171">        toolbar.addSeparator();</span>
<span class="nc" id="L172">        fileMenu.addSeparator();</span>

<span class="nc" id="L174">        action = new NewMetricsAction(this);</span>
<span class="nc" id="L175">        menuItem = fileMenu.add(action);</span>
<span class="nc" id="L176">        menuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_N, Event.CTRL_MASK));</span>
<span class="nc" id="L177">        menuItem.setMnemonic('n');</span>
<span class="nc" id="L178">        button = toolbar.add(action);</span>
<span class="nc" id="L179">        button.setToolTipText((String) action.getValue(Action.LONG_DESCRIPTION));</span>

<span class="nc" id="L181">        toolbar.addSeparator();</span>
<span class="nc" id="L182">        fileMenu.addSeparator();</span>

<span class="nc" id="L184">        action = new ExitAction(this);</span>
<span class="nc" id="L185">        menuItem = fileMenu.add(action);</span>
<span class="nc" id="L186">        menuItem.setAccelerator(KeyStroke.getKeyStroke(KeyEvent.VK_X, Event.CTRL_MASK));</span>
<span class="nc" id="L187">        menuItem.setMnemonic('x');</span>

<span class="nc" id="L189">        this.setJMenuBar(menuBar);</span>
<span class="nc" id="L190">    }</span>

    private void buildHelpMenu() {
<span class="nc" id="L193">        menuBar.add(helpMenu);</span>

<span class="nc" id="L195">        helpMenu.setText(&quot;Help&quot;);</span>

        Action action;
        JMenuItem menuItem;

<span class="nc" id="L200">        action = new AboutAction(this);</span>
<span class="nc" id="L201">        menuItem = helpMenu.add(action);</span>
<span class="nc" id="L202">        menuItem.setMnemonic('a');</span>
<span class="nc" id="L203">    }</span>
    
    private void buildUI() {
<span class="nc" id="L206">        this.getContentPane().setLayout(new BorderLayout());</span>
<span class="nc" id="L207">        this.getContentPane().add(buildControlPanel(), BorderLayout.NORTH);</span>
<span class="nc" id="L208">        this.getContentPane().add(buildResultPanel(), BorderLayout.CENTER);</span>
<span class="nc" id="L209">        this.getContentPane().add(buildStatusPanel(), BorderLayout.SOUTH);</span>
<span class="nc" id="L210">    }</span>

    private JComponent buildControlPanel() {
<span class="nc" id="L213">        return toolbar;</span>
    }
    
    private JComponent buildResultPanel() {
<span class="nc" id="L217">        JPanel result = new JPanel();</span>

<span class="nc" id="L219">        result.setLayout(new BorderLayout());</span>
<span class="nc" id="L220">        result.add(new JSplitPane(JSplitPane.VERTICAL_SPLIT, buildProjectPanel(), buildChartsPanel()), BorderLayout.CENTER);</span>
<span class="nc" id="L221">        result.add(buildFilterPanel(), BorderLayout.SOUTH);</span>

<span class="nc" id="L223">        return result;</span>
    }

    private JComponent buildProjectPanel() {
<span class="nc" id="L227">        JComponent result = new JScrollPane(projectArea);</span>

<span class="nc" id="L229">        projectArea.setEditable(false);</span>

<span class="nc" id="L231">        return result;</span>
    }

    private JComponent buildChartsPanel() {
<span class="nc" id="L235">        JTabbedPane result = new JTabbedPane();</span>

        // result.setBorder(BorderFactory.createTitledBorder(&quot;Data&quot;));
<span class="nc" id="L238">        result.addTab(&quot;Groups&quot;,  buildGroupsChartPanel());</span>
<span class="nc" id="L239">        result.addTab(&quot;Classes&quot;, buildClassesChartPanel());</span>
<span class="nc" id="L240">        result.addTab(&quot;Methods&quot;, buildMethodsChartPanel());</span>

<span class="nc" id="L242">        return result;</span>
    }

    private JComponent buildGroupsChartPanel() {
<span class="nc" id="L246">        return buildChartPanel(getGroupsModel());</span>
    }

    private JComponent buildClassesChartPanel() {
<span class="nc" id="L250">        return buildChartPanel(getClassesModel());</span>
    }

    private JComponent buildMethodsChartPanel() {
<span class="nc" id="L254">        return buildChartPanel(getMethodsModel());</span>
    }

    private JComponent buildChartPanel(OOMetricsTableModel model) {
        JComponent result;

<span class="nc" id="L260">        JTable table = new JTable(model);</span>

<span class="nc" id="L262">        table.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);</span>
<span class="nc" id="L263">        table.setRowSelectionAllowed(true);</span>
<span class="nc" id="L264">        table.setDefaultRenderer(Object.class, RENDERER);</span>
<span class="nc" id="L265">        table.setShowHorizontalLines(false);</span>
<span class="nc" id="L266">        table.setShowVerticalLines(false);</span>
<span class="nc" id="L267">        TableHeaderListener listener = new TableHeaderListener(table, model);</span>
<span class="nc" id="L268">        table.getTableHeader().addMouseListener(listener);</span>
<span class="nc" id="L269">        table.getTableHeader().addMouseMotionListener(listener);</span>

<span class="nc" id="L271">        result = new JScrollPane(table);</span>

<span class="nc" id="L273">        return result;</span>
    }

    private JComponent buildFilterPanel() {
<span class="nc" id="L277">        JPanel result = new JPanel();</span>

<span class="nc" id="L279">        result.setLayout(new BorderLayout());</span>
<span class="nc" id="L280">        result.add(filterButton, BorderLayout.WEST);</span>
<span class="nc" id="L281">        result.add(filterField,  BorderLayout.CENTER);</span>

<span class="nc" id="L283">        filterButton.addActionListener(new FilterActionListener(this));</span>

<span class="nc" id="L285">        return result;</span>
    }

    private JComponent buildStatusPanel() {
<span class="nc" id="L289">        JPanel result = new JPanel();</span>

<span class="nc" id="L291">        Dimension size = getProgressBar().getPreferredSize();</span>
<span class="nc" id="L292">        size.width = 100;</span>
<span class="nc" id="L293">        getProgressBar().setPreferredSize(size);</span>
<span class="nc" id="L294">        getProgressBar().setBorder(BorderFactory.createBevelBorder(BevelBorder.LOWERED));</span>

<span class="nc" id="L296">        result.setLayout(new BorderLayout());</span>
<span class="nc" id="L297">        result.add(getStatusLine(),  BorderLayout.CENTER);</span>
<span class="nc" id="L298">        result.add(getProgressBar(), BorderLayout.EAST);</span>

<span class="nc" id="L300">        return result;</span>
    }

    public static void showError(CommandLineUsage clu, String msg) {
<span class="nc" id="L304">        System.err.println(msg);</span>
<span class="nc" id="L305">        showError(clu);</span>
<span class="nc" id="L306">    }</span>

    public static void showError(CommandLineUsage clu) {
<span class="nc" id="L309">        System.err.println(clu);</span>
<span class="nc" id="L310">    }</span>

    public static void main(String[] args) throws Exception {
        // Parsing the command line
<span class="nc" id="L314">        CommandLine commandLine = new CommandLine(new NullParameterStrategy());</span>
<span class="nc" id="L315">        commandLine.addSingleValueSwitch(&quot;default-configuration&quot;, true);</span>
<span class="nc" id="L316">        commandLine.addSingleValueSwitch(&quot;configuration&quot;);</span>
<span class="nc" id="L317">        commandLine.addToggleSwitch(&quot;validate&quot;);</span>
<span class="nc" id="L318">        commandLine.addToggleSwitch(&quot;enable-cross-class-measurements&quot;);</span>
<span class="nc" id="L319">        commandLine.addToggleSwitch(&quot;help&quot;);</span>

<span class="nc" id="L321">        CommandLineUsage usage = new CommandLineUsage(&quot;OOMetrics&quot;);</span>
<span class="nc" id="L322">        commandLine.accept(usage);</span>

        try {
<span class="nc" id="L325">            commandLine.parse(args);</span>
<span class="nc" id="L326">        } catch (IllegalArgumentException ex) {</span>
<span class="nc" id="L327">            showError(usage, ex.toString());</span>
<span class="nc" id="L328">            System.exit(1);</span>
<span class="nc" id="L329">        }</span>

<span class="nc bnc" id="L331" title="All 2 branches missed.">        if (commandLine.getToggleSwitch(&quot;help&quot;)) {</span>
<span class="nc" id="L332">            showError(usage);</span>
<span class="nc" id="L333">            System.exit(1);</span>
        }

        MetricsFactory factory;

<span class="nc bnc" id="L338" title="All 2 branches missed.">        if (commandLine.isPresent(&quot;configuration&quot;)) {</span>
<span class="nc" id="L339">            factory = new MetricsFactory(&quot;Project&quot;, new MetricsConfigurationLoader(commandLine.getToggleSwitch(&quot;validate&quot;)).load(commandLine.getSingleSwitch(&quot;configuration&quot;)));</span>
        } else {
<span class="nc" id="L341">            factory = new MetricsFactory(&quot;Project&quot;, new MetricsConfigurationLoader(commandLine.getToggleSwitch(&quot;validate&quot;)).load(commandLine.getSingleSwitch(&quot;default-configuration&quot;)));</span>
        }

        /*
         *  Beginning of main processing
         */

        try {
<span class="nc" id="L349">            UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());</span>
<span class="nc" id="L350">        } catch (Exception ex) {</span>
            // Ignore
<span class="nc" id="L352">        }</span>

<span class="nc" id="L354">        OOMetrics model = new OOMetrics(factory, commandLine.isPresent(&quot;enable-cross-class-measurements&quot;));</span>
<span class="nc" id="L355">        model.setVisible(true);</span>
<span class="nc" id="L356">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>