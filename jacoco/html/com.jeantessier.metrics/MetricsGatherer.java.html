<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MetricsGatherer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">code-coverage-report</a> &gt; <a href="index.source.html" class="el_package">com.jeantessier.metrics</a> &gt; <span class="el_source">MetricsGatherer.java</span></div><h1>MetricsGatherer.java</h1><pre class="source lang-java linenums">/*
 *  Copyright (c) 2001-2025, Jean Tessier
 *  All rights reserved.
 *  
 *  Redistribution and use in source and binary forms, with or without
 *  modification, are permitted provided that the following conditions
 *  are met:
 *  
 *      * Redistributions of source code must retain the above copyright
 *        notice, this list of conditions and the following disclaimer.
 *  
 *      * Redistributions in binary form must reproduce the above copyright
 *        notice, this list of conditions and the following disclaimer in the
 *        documentation and/or other materials provided with the distribution.
 *  
 *      * Neither the name of Jean Tessier nor the names of his contributors
 *        may be used to endorse or promote products derived from this software
 *        without specific prior written permission.
 *  
 *  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 *  &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 *  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 *  A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR
 *  CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 *  PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 *  PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

package com.jeantessier.metrics;

import com.jeantessier.classreader.*;
import org.apache.logging.log4j.*;
import org.apache.oro.text.perl.Perl5Util;

import java.util.*;
import java.util.stream.Stream;

/**
 *  &lt;p&gt;Collects metrics from Classfile instances.&lt;/p&gt;
 *  
 *  &lt;p&gt;This class can only approximate SLOC based on information provided
 *  by the compiler.&lt;/p&gt;
 */
public class MetricsGatherer extends VisitorBase {
<span class="fc" id="L49">    private static final Perl5Util perl = new Perl5Util();</span>

    private final MetricsFactory factory;

<span class="fc" id="L53">    private Collection&lt;String&gt; scope = null;</span>
<span class="fc" id="L54">    private Collection&lt;String&gt; filter = null;</span>
    
    private Metrics currentProject;
    private Metrics currentGroup;
    private Metrics currentClass;
    private Metrics currentMethod;

    private int sloc;

<span class="fc" id="L63">    private final Collection&lt;MetricsListener&gt; metricsListeners = new HashSet&lt;&gt;();</span>

<span class="fc" id="L65">    public MetricsGatherer(MetricsFactory factory) {</span>
<span class="fc" id="L66">        this.factory = factory;</span>

<span class="fc" id="L68">        setCurrentProject(getMetricsFactory().createProjectMetrics());</span>
<span class="fc" id="L69">    }</span>

    public MetricsFactory getMetricsFactory() {
<span class="fc" id="L72">        return factory;</span>
    }

    public void setScopeIncludes(Collection&lt;String&gt; scope) {
<span class="fc" id="L76">        this.scope = scope;</span>
<span class="fc" id="L77">    }</span>
    
    public void setFilterIncludes(Collection&lt;String&gt; filter) {
<span class="fc" id="L80">        this.filter = filter;</span>
<span class="fc" id="L81">    }</span>
    
    private Metrics getCurrentProject() {
<span class="fc" id="L84">        return currentProject;</span>
    }

    void setCurrentProject(Metrics currentProject) {
<span class="fc" id="L88">        this.currentProject = currentProject;</span>
<span class="fc" id="L89">    }</span>

    private Metrics getCurrentGroup() {
<span class="fc" id="L92">        return currentGroup;</span>
    }

    void setCurrentGroup(Metrics currentGroup) {
<span class="fc" id="L96">        this.currentGroup = currentGroup;</span>
<span class="fc" id="L97">    }</span>

    private Metrics getCurrentClass() {
<span class="fc" id="L100">        return currentClass;</span>
    }

    void setCurrentClass(Metrics currentClass) {
<span class="fc" id="L104">        this.currentClass = currentClass;</span>
<span class="fc" id="L105">    }</span>

    private Metrics getCurrentMethod() {
<span class="fc" id="L108">        return currentMethod;</span>
    }

    void setCurrentMethod(Metrics currentMethod) {
<span class="fc" id="L112">        this.currentMethod = currentMethod;</span>
<span class="fc" id="L113">    }</span>

    private Collection&lt;Metrics&gt; getAllMatchingGroups(String className) {
<span class="fc" id="L116">        return Stream.concat(</span>
<span class="fc" id="L117">                Stream.of(getCurrentGroup()),</span>
<span class="fc" id="L118">                getMetricsFactory().getGroupMetrics(className).stream()</span>
<span class="fc" id="L119">        ).toList();</span>
    }

    public void visitClassfiles(Collection&lt;Classfile&gt; classfiles) {
<span class="fc" id="L123">        fireBeginSession(classfiles.size());</span>

<span class="fc" id="L125">        super.visitClassfiles(classfiles);</span>
        
<span class="fc" id="L127">        fireEndSession();</span>
<span class="fc" id="L128">    }</span>
    
    // Classfile
    public void visitClassfile(Classfile classfile) {
<span class="fc" id="L132">        String className = classfile.getClassName();</span>

<span class="fc" id="L134">        LogManager.getLogger(getClass()).debug(&quot;visitClassfile():&quot;);</span>
<span class="fc" id="L135">        LogManager.getLogger(getClass()).debug(&quot;    class = \&quot;{}\&quot;&quot;, className);</span>
<span class="fc" id="L136">        LogManager.getLogger(getClass()).debug(&quot;    access flag: {}&quot;, classfile::getAccessFlags);</span>
<span class="fc" id="L137">        LogManager.getLogger(getClass()).debug(&quot;    public: {}&quot;, classfile::isPublic);</span>
<span class="fc" id="L138">        LogManager.getLogger(getClass()).debug(&quot;    final: {}&quot;, classfile::isFinal);</span>
<span class="fc" id="L139">        LogManager.getLogger(getClass()).debug(&quot;    super: {}&quot;, classfile::isSuper);</span>
<span class="fc" id="L140">        LogManager.getLogger(getClass()).debug(&quot;    interface: {}&quot;, classfile::isInterface);</span>
<span class="fc" id="L141">        LogManager.getLogger(getClass()).debug(&quot;    abstract: {}&quot;, classfile::isAbstract);</span>
<span class="fc" id="L142">        LogManager.getLogger(getClass()).debug(&quot;    synthetic: {}&quot;, classfile::isSynthetic);</span>
<span class="fc" id="L143">        LogManager.getLogger(getClass()).debug(&quot;    annotation: {}&quot;, classfile::isAnnotation);</span>
<span class="fc" id="L144">        LogManager.getLogger(getClass()).debug(&quot;    enum: {}&quot;, classfile::isEnum);</span>
<span class="fc" id="L145">        LogManager.getLogger(getClass()).debug(&quot;    module: {}&quot;, classfile::isModule);</span>

<span class="fc" id="L147">        fireBeginClass(classfile);</span>
        
<span class="fc" id="L149">        setCurrentMethod(null);</span>
<span class="fc" id="L150">        setCurrentClass(getMetricsFactory().createClassMetrics(className));</span>
<span class="fc" id="L151">        setCurrentGroup(getCurrentClass().getParent());</span>
<span class="fc" id="L152">        setCurrentProject(getCurrentGroup().getParent());</span>

<span class="fc" id="L154">        getMetricsFactory().includeClassMetrics(getCurrentClass());</span>

<span class="fc" id="L156">        getCurrentClass().addToMeasurement(BasicMeasurements.MAJOR_VERSION, classfile.getMajorVersion());</span>
<span class="fc" id="L157">        getCurrentClass().addToMeasurement(BasicMeasurements.MINOR_VERSION, classfile.getMinorVersion());</span>

<span class="fc" id="L159">        Collection&lt;Metrics&gt; groups = getAllMatchingGroups(className);</span>

<span class="fc" id="L161">        groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PACKAGES, getCurrentGroup().getName()));</span>

<span class="fc" id="L163">        getCurrentProject().addToMeasurement(BasicMeasurements.CLASSES, className);</span>
<span class="fc" id="L164">        groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.CLASSES, className));</span>

<span class="fc bfc" id="L166" title="All 2 branches covered.">        if (classfile.isPublic()) {</span>
<span class="fc" id="L167">            getCurrentProject().addToMeasurement(BasicMeasurements.PUBLIC_CLASSES, className);</span>
<span class="fc" id="L168">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PUBLIC_CLASSES, className));</span>
        } else {
<span class="fc" id="L170">            getCurrentProject().addToMeasurement(BasicMeasurements.PACKAGE_CLASSES, className);</span>
<span class="fc" id="L171">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PACKAGE_CLASSES, className));</span>
        }

<span class="fc bfc" id="L174" title="All 2 branches covered.">        if (classfile.isFinal()) {</span>
<span class="fc" id="L175">            getCurrentProject().addToMeasurement(BasicMeasurements.FINAL_CLASSES, className);</span>
<span class="fc" id="L176">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.FINAL_CLASSES, className));</span>
        }

<span class="fc bfc" id="L179" title="All 2 branches covered.">        if (classfile.isSuper()) {</span>
<span class="fc" id="L180">            getCurrentProject().addToMeasurement(BasicMeasurements.SUPER_CLASSES, className);</span>
<span class="fc" id="L181">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.SUPER_CLASSES, className));</span>
        }

<span class="fc bfc" id="L184" title="All 2 branches covered.">        if (classfile.isInterface()) {</span>
<span class="fc" id="L185">            getCurrentProject().addToMeasurement(BasicMeasurements.INTERFACES, className);</span>
<span class="fc" id="L186">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.INTERFACES, className));</span>
        }

<span class="fc bfc" id="L189" title="All 2 branches covered.">        if (classfile.isAbstract()) {</span>
<span class="fc" id="L190">            getCurrentProject().addToMeasurement(BasicMeasurements.ABSTRACT_CLASSES, className);</span>
<span class="fc" id="L191">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.ABSTRACT_CLASSES, className));</span>
        }

<span class="fc bfc" id="L194" title="All 2 branches covered.">        if (classfile.isSynthetic()) {</span>
<span class="fc" id="L195">            getCurrentProject().addToMeasurement(BasicMeasurements.SYNTHETIC_CLASSES, className);</span>
<span class="fc" id="L196">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.SYNTHETIC_CLASSES, className));</span>
        }

<span class="fc bfc" id="L199" title="All 2 branches covered.">        if (classfile.isAnnotation()) {</span>
<span class="fc" id="L200">            getCurrentProject().addToMeasurement(BasicMeasurements.ANNOTATION_CLASSES, className);</span>
<span class="fc" id="L201">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.ANNOTATION_CLASSES, className));</span>
        }

<span class="fc bfc" id="L204" title="All 2 branches covered.">        if (classfile.isEnum()) {</span>
<span class="fc" id="L205">            getCurrentProject().addToMeasurement(BasicMeasurements.ENUM_CLASSES, className);</span>
<span class="fc" id="L206">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.ENUM_CLASSES, className));</span>
        }

<span class="fc bfc" id="L209" title="All 2 branches covered.">        if (classfile.isModule()) {</span>
<span class="fc" id="L210">            getCurrentProject().addToMeasurement(BasicMeasurements.MODULE_CLASSES, className);</span>
<span class="fc" id="L211">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.MODULE_CLASSES, className));</span>
        }

<span class="fc bfc" id="L214" title="All 2 branches covered.">        if (classfile.isDeprecated()) {</span>
<span class="fc" id="L215">            getCurrentProject().addToMeasurement(BasicMeasurements.DEPRECATED_CLASSES, className);</span>
<span class="fc" id="L216">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.DEPRECATED_CLASSES, className));</span>
        }

<span class="fc bfc" id="L219" title="All 2 branches covered.">        if (classfile.hasSuperclass()) {</span>
<span class="fc" id="L220">            classfile.getRawSuperclass().accept(this);</span>

<span class="fc" id="L222">            getMetricsFactory().createClassMetrics(classfile.getSuperclassName()).addToMeasurement(BasicMeasurements.SUBCLASSES);</span>

<span class="fc" id="L224">            Classfile superclass = classfile.getLoader().getClassfile(classfile.getSuperclassName());</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">            if (superclass != null) {</span>
<span class="fc" id="L226">                getCurrentClass().addToMeasurement(BasicMeasurements.DEPTH_OF_INHERITANCE, computeDepthOfInheritance(superclass));</span>
            }
        }

<span class="fc" id="L230">        classfile.getAllInterfaces().forEach(class_info -&gt; class_info.accept(this));</span>
<span class="fc" id="L231">        classfile.getAllFields().forEach(field -&gt; field.accept(this));</span>
<span class="fc" id="L232">        classfile.getAllMethods().forEach(method -&gt; method.accept(this));</span>

<span class="fc" id="L234">        sloc = 1;</span>

<span class="fc" id="L236">        classfile.getAttributes().forEach(attribute -&gt; attribute.accept(this));</span>

<span class="fc bfc" id="L238" title="All 2 branches covered.">        if (!classfile.isSynthetic()) {</span>
<span class="fc" id="L239">            getCurrentClass().addToMeasurement(BasicMeasurements.CLASS_SLOC, sloc);</span>
        }

<span class="fc" id="L242">        fireEndClass(classfile, getCurrentClass());</span>
<span class="fc" id="L243">    }</span>
    
    // ConstantPool entries
    public void visitClass_info(Class_info entry) {
<span class="fc" id="L247">        LogManager.getLogger(getClass()).debug(&quot;visitClass_info():&quot;);</span>
<span class="fc" id="L248">        LogManager.getLogger(getClass()).debug(&quot;    name = \&quot;{}\&quot;&quot;, entry::getName);</span>
<span class="pc bpc" id="L249" title="1 of 2 branches missed.">        if (entry.getName().startsWith(&quot;[&quot;)) {</span>
<span class="nc" id="L250">            addClassDependencies(processDescriptor(entry.getName()));</span>
        } else {
<span class="fc" id="L252">            addClassDependency(entry.getName());</span>
        }
<span class="fc" id="L254">    }</span>
    
    public void visitFieldRef_info(FieldRef_info entry) {
<span class="fc" id="L257">        LogManager.getLogger(getClass()).debug(&quot;visitFieldRef_info():&quot;);</span>
<span class="fc" id="L258">        LogManager.getLogger(getClass()).debug(&quot;    class = \&quot;{}\&quot;&quot;, entry::getClassName);</span>
<span class="pc" id="L259">        LogManager.getLogger(getClass()).debug(&quot;    name = \&quot;{}\&quot;&quot;, () -&gt; entry.getRawNameAndType().getName());</span>
<span class="pc" id="L260">        LogManager.getLogger(getClass()).debug(&quot;    type = \&quot;{}\&quot;&quot;, () -&gt; entry.getRawNameAndType().getType());</span>

        // Dependencies on attributes are accounted as dependencies on their class
<span class="fc" id="L263">        entry.getRawClass().accept(this);</span>
<span class="fc" id="L264">        addClassDependencies(processDescriptor(entry.getRawNameAndType().getType()));</span>
<span class="fc" id="L265">    }</span>

    public void visitMethodRef_info(MethodRef_info entry) {
<span class="fc" id="L268">        LogManager.getLogger(getClass()).debug(&quot;visitMethodRef_info():&quot;);</span>
<span class="fc" id="L269">        LogManager.getLogger(getClass()).debug(&quot;    class = \&quot;{}\&quot;&quot;, entry::getClassName);</span>
<span class="pc" id="L270">        LogManager.getLogger(getClass()).debug(&quot;    name = \&quot;{}\&quot;&quot;, () -&gt; entry.getRawNameAndType().getName());</span>
<span class="pc" id="L271">        LogManager.getLogger(getClass()).debug(&quot;    type = \&quot;{}\&quot;&quot;, () -&gt; entry.getRawNameAndType().getType());</span>
<span class="fc" id="L272">        addMethodDependency(entry.getFullUniqueName());</span>
<span class="fc" id="L273">        addClassDependencies(processDescriptor(entry.getRawNameAndType().getType()));</span>
<span class="fc" id="L274">    }</span>

    public void visitInterfaceMethodRef_info(InterfaceMethodRef_info entry) {
<span class="nc" id="L277">        LogManager.getLogger(getClass()).debug(&quot;visitInterfaceMethodRef_info():&quot;);</span>
<span class="nc" id="L278">        LogManager.getLogger(getClass()).debug(&quot;    class = \&quot;{}\&quot;&quot;, entry::getClassName);</span>
<span class="nc" id="L279">        LogManager.getLogger(getClass()).debug(&quot;    name = \&quot;{}\&quot;&quot;, () -&gt; entry.getRawNameAndType().getName());</span>
<span class="nc" id="L280">        LogManager.getLogger(getClass()).debug(&quot;    type = \&quot;{}\&quot;&quot;, () -&gt; entry.getRawNameAndType().getType());</span>
<span class="nc" id="L281">        addMethodDependency(entry.getFullUniqueName());</span>
<span class="nc" id="L282">        addClassDependencies(processDescriptor(entry.getRawNameAndType().getType()));</span>
<span class="nc" id="L283">    }</span>

    public void visitField_info(Field_info entry) {
<span class="fc" id="L286">        String fullUniqueName = entry.getFullUniqueName();</span>

<span class="fc" id="L288">        LogManager.getLogger(getClass()).debug(&quot;visitField_info({})&quot;, entry::getFullSignature);</span>
<span class="pc" id="L289">        LogManager.getLogger(getClass()).debug(&quot;    current class: {}&quot;, () -&gt; getCurrentClass().getName());</span>
<span class="fc" id="L290">        LogManager.getLogger(getClass()).debug(&quot;    access flag: {}&quot;, entry::getAccessFlags);</span>
<span class="fc" id="L291">        LogManager.getLogger(getClass()).debug(&quot;    public: {}&quot;, entry::isPublic);</span>
<span class="fc" id="L292">        LogManager.getLogger(getClass()).debug(&quot;    private: {}&quot;, entry::isPrivate);</span>
<span class="fc" id="L293">        LogManager.getLogger(getClass()).debug(&quot;    protected: {}&quot;, entry::isProtected);</span>
<span class="fc" id="L294">        LogManager.getLogger(getClass()).debug(&quot;    static: {}&quot;, entry::isStatic);</span>
<span class="fc" id="L295">        LogManager.getLogger(getClass()).debug(&quot;    final: {}&quot;, entry::isFinal);</span>
<span class="fc" id="L296">        LogManager.getLogger(getClass()).debug(&quot;    volatile: {}&quot;, entry::isVolatile);</span>
<span class="fc" id="L297">        LogManager.getLogger(getClass()).debug(&quot;    transient: {}&quot;, entry::isTransient);</span>
<span class="fc" id="L298">        LogManager.getLogger(getClass()).debug(&quot;    synthetic: {}&quot;, entry::isSynthetic);</span>
<span class="fc" id="L299">        LogManager.getLogger(getClass()).debug(&quot;    enum: {}&quot;, entry::isEnum);</span>

<span class="fc" id="L301">        getCurrentClass().addToMeasurement(BasicMeasurements.ATTRIBUTES, fullUniqueName);</span>

<span class="fc bfc" id="L303" title="All 2 branches covered.">        if (entry.isPublic()) {</span>
<span class="fc" id="L304">            getCurrentClass().addToMeasurement(BasicMeasurements.PUBLIC_ATTRIBUTES, fullUniqueName);</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">        } else if (entry.isPrivate()) {</span>
<span class="fc" id="L306">            getCurrentClass().addToMeasurement(BasicMeasurements.PRIVATE_ATTRIBUTES, fullUniqueName);</span>
<span class="fc bfc" id="L307" title="All 2 branches covered.">        } else if (entry.isProtected()) {</span>
<span class="fc" id="L308">            getCurrentClass().addToMeasurement(BasicMeasurements.PROTECTED_ATTRIBUTES, fullUniqueName);</span>
        } else {
<span class="fc" id="L310">            getCurrentClass().addToMeasurement(BasicMeasurements.PACKAGE_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L313" title="All 2 branches covered.">        if (entry.isFinal()) {</span>
<span class="fc" id="L314">            getCurrentClass().addToMeasurement(BasicMeasurements.FINAL_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L317" title="All 2 branches covered.">        if (entry.isDeprecated()) {</span>
<span class="fc" id="L318">            getCurrentClass().addToMeasurement(BasicMeasurements.DEPRECATED_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L321" title="All 2 branches covered.">        if (entry.isSynthetic()) {</span>
<span class="fc" id="L322">            getCurrentClass().addToMeasurement(BasicMeasurements.SYNTHETIC_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L325" title="All 2 branches covered.">        if (entry.isStatic()) {</span>
<span class="fc" id="L326">            getCurrentClass().addToMeasurement(BasicMeasurements.STATIC_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L329" title="All 2 branches covered.">        if (entry.isTransient()) {</span>
<span class="fc" id="L330">            getCurrentClass().addToMeasurement(BasicMeasurements.TRANSIENT_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L333" title="All 2 branches covered.">        if (entry.isVolatile()) {</span>
<span class="fc" id="L334">            getCurrentClass().addToMeasurement(BasicMeasurements.VOLATILE_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc bfc" id="L337" title="All 2 branches covered.">        if (entry.isEnum()) {</span>
<span class="fc" id="L338">            getCurrentClass().addToMeasurement(BasicMeasurements.ENUM_ATTRIBUTES, fullUniqueName);</span>
        }

<span class="fc" id="L341">        sloc = 1;</span>

<span class="fc" id="L343">        super.visitField_info(entry);</span>
        
<span class="fc bfc" id="L345" title="All 2 branches covered.">        if (!entry.isSynthetic()) {</span>
<span class="fc" id="L346">            getCurrentClass().addToMeasurement(BasicMeasurements.CLASS_SLOC, sloc);</span>
        }

<span class="fc" id="L349">        addClassDependencies(processDescriptor(entry.getDescriptor()));</span>
<span class="fc" id="L350">    }</span>

    public void visitMethod_info(Method_info entry) {
<span class="fc" id="L353">        fireBeginMethod(entry);</span>

<span class="fc" id="L355">        setCurrentMethod(getMetricsFactory().createMethodMetrics(entry.getFullUniqueName()));</span>
<span class="fc" id="L356">        getMetricsFactory().includeMethodMetrics(getCurrentMethod());</span>
        
<span class="fc" id="L358">        LogManager.getLogger(getClass()).debug(&quot;visitMethod_info({})&quot;, entry::getFullSignature);</span>
<span class="pc" id="L359">        LogManager.getLogger(getClass()).debug(&quot;    current class: {}&quot;, () -&gt; getCurrentClass().getName());</span>
<span class="fc" id="L360">        LogManager.getLogger(getClass()).debug(&quot;    access flag: {}&quot;, entry::getAccessFlags);</span>
<span class="fc" id="L361">        LogManager.getLogger(getClass()).debug(&quot;    public: {}&quot;, entry::isPublic);</span>
<span class="fc" id="L362">        LogManager.getLogger(getClass()).debug(&quot;    private: {}&quot;, entry::isPrivate);</span>
<span class="fc" id="L363">        LogManager.getLogger(getClass()).debug(&quot;    protected: {}&quot;, entry::isProtected);</span>
<span class="fc" id="L364">        LogManager.getLogger(getClass()).debug(&quot;    static: {}&quot;, entry::isStatic);</span>
<span class="fc" id="L365">        LogManager.getLogger(getClass()).debug(&quot;    final: {}&quot;, entry::isFinal);</span>
<span class="fc" id="L366">        LogManager.getLogger(getClass()).debug(&quot;    synchronized: {}&quot;, entry::isSynchronized);</span>
<span class="fc" id="L367">        LogManager.getLogger(getClass()).debug(&quot;    bridge: {}&quot;, entry::isBridge);</span>
<span class="fc" id="L368">        LogManager.getLogger(getClass()).debug(&quot;    varars: {}&quot;, entry::isVarargs);</span>
<span class="fc" id="L369">        LogManager.getLogger(getClass()).debug(&quot;    native: {}&quot;, entry::isNative);</span>
<span class="fc" id="L370">        LogManager.getLogger(getClass()).debug(&quot;    abstract: {}&quot;, entry::isAbstract);</span>
<span class="fc" id="L371">        LogManager.getLogger(getClass()).debug(&quot;    strict: {}&quot;, entry::isStrict);</span>
<span class="fc" id="L372">        LogManager.getLogger(getClass()).debug(&quot;    synthetic: {}&quot;, entry::isSynthetic);</span>

<span class="fc" id="L374">        sloc = 1;</span>

<span class="fc" id="L376">        getCurrentClass().addToMeasurement(BasicMeasurements.METHODS, getCurrentMethod().getName());</span>

<span class="fc bfc" id="L378" title="All 2 branches covered.">        if (entry.isPublic()) {</span>
<span class="fc" id="L379">            getCurrentClass().addToMeasurement(BasicMeasurements.PUBLIC_METHODS, getCurrentMethod().getName());</span>
<span class="fc bfc" id="L380" title="All 2 branches covered.">        } else if (entry.isPrivate()) {</span>
<span class="fc" id="L381">            getCurrentClass().addToMeasurement(BasicMeasurements.PRIVATE_METHODS, getCurrentMethod().getName());</span>
<span class="fc bfc" id="L382" title="All 2 branches covered.">        } else if (entry.isProtected()) {</span>
<span class="fc" id="L383">            getCurrentClass().addToMeasurement(BasicMeasurements.PROTECTED_METHODS, getCurrentMethod().getName());</span>
        } else {
<span class="fc" id="L385">            getCurrentClass().addToMeasurement(BasicMeasurements.PACKAGE_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L388" title="All 2 branches covered.">        if (entry.isFinal()) {</span>
<span class="fc" id="L389">            getCurrentClass().addToMeasurement(BasicMeasurements.FINAL_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L392" title="All 2 branches covered.">        if (entry.isAbstract()) {</span>
<span class="fc" id="L393">            getCurrentClass().addToMeasurement(BasicMeasurements.ABSTRACT_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L396" title="All 2 branches covered.">        if (entry.isDeprecated()) {</span>
<span class="fc" id="L397">            getCurrentClass().addToMeasurement(BasicMeasurements.DEPRECATED_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L400" title="All 2 branches covered.">        if (entry.isSynthetic()) {</span>
<span class="fc" id="L401">            getCurrentClass().addToMeasurement(BasicMeasurements.SYNTHETIC_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L404" title="All 2 branches covered.">        if (entry.isStatic()) {</span>
<span class="fc" id="L405">            getCurrentClass().addToMeasurement(BasicMeasurements.STATIC_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L408" title="All 2 branches covered.">        if (entry.isSynchronized()) {</span>
<span class="fc" id="L409">            getCurrentClass().addToMeasurement(BasicMeasurements.SYNCHRONIZED_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L412" title="All 2 branches covered.">        if (entry.isBridge()) {</span>
<span class="fc" id="L413">            getCurrentClass().addToMeasurement(BasicMeasurements.BRIDGE_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L416" title="All 2 branches covered.">        if (entry.isVarargs()) {</span>
<span class="fc" id="L417">            getCurrentClass().addToMeasurement(BasicMeasurements.VARARGS_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L420" title="All 2 branches covered.">        if (entry.isNative()) {</span>
<span class="fc" id="L421">            getCurrentClass().addToMeasurement(BasicMeasurements.NATIVE_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc bfc" id="L424" title="All 2 branches covered.">        if (entry.isStrict()) {</span>
<span class="fc" id="L425">            getCurrentClass().addToMeasurement(BasicMeasurements.STRICT_METHODS, getCurrentMethod().getName());</span>
        }

<span class="fc" id="L428">        getCurrentMethod().addToMeasurement(BasicMeasurements.PARAMETERS, DescriptorHelper.getParameterCount(entry.getDescriptor()));</span>
        
<span class="fc" id="L430">        super.visitMethod_info(entry);</span>
        
<span class="fc bfc" id="L432" title="All 2 branches covered.">        if (!entry.isSynthetic()) {</span>
<span class="fc" id="L433">            getCurrentMethod().addToMeasurement(BasicMeasurements.SLOC, sloc);</span>
        }

<span class="fc" id="L436">        addClassDependencies(processDescriptor(entry.getDescriptor()));</span>

<span class="fc" id="L438">        fireEndMethod(entry, getCurrentMethod());</span>
<span class="fc" id="L439">    }</span>

    // 
    // Attributes
    //

    //
    // Attribute helpers
    //

    public void visitInstruction(Instruction helper) {
<span class="fc" id="L450">        super.visitInstruction(helper);</span>

        /*
         *  We can skip the &quot;new&quot; (0xbb) instruction as it is always
         *  followed by a call to the constructor method.
         */

<span class="fc bfc" id="L457" title="All 2 branches covered.">        switch (helper.getOpcode()) {</span>
            case 0x12: // ldc
            case 0x13: // ldc_w
            case 0xb2: // getstatic
            case 0xb3: // putstatic
            case 0xb4: // getfield
            case 0xb5: // putfield
            case 0xb6: // invokevirtual
            case 0xb7: // invokespecial
            case 0xb8: // invokestatic
            case 0xb9: // invokeinterface
            // case 0xbb: // new
            case 0xbd: // anewarray
            case 0xc0: // checkcast
            case 0xc1: // instanceof
            case 0xc5: // multianewarray
<span class="fc" id="L473">                helper.getIndexedConstantPoolEntry().accept(this);</span>
<span class="fc" id="L474">                break;</span>
            default:
                // Do nothing
                break;
        }
<span class="fc" id="L479">    }</span>

    public void visitExceptionHandler(ExceptionHandler helper) {
<span class="pc bpc" id="L482" title="1 of 2 branches missed.">        if (helper.hasCatchType()) {</span>
<span class="fc" id="L483">            helper.getRawCatchType().accept(this);</span>
        }
<span class="fc" id="L485">    }</span>

    public void visitInnerClass(InnerClass helper) {
<span class="pc bpc" id="L488" title="1 of 2 branches missed.">        if (isInnerClassOfCurrentClass(helper)) {</span>
<span class="fc" id="L489">            String innerClassName = helper.getInnerClassInfo();</span>

<span class="fc" id="L491">            Collection&lt;Metrics&gt; groups = getAllMatchingGroups(innerClassName);</span>

<span class="fc" id="L493">            getCurrentProject().addToMeasurement(BasicMeasurements.INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L494">            groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L495">            getCurrentClass().addToMeasurement(BasicMeasurements.INNER_CLASSES, innerClassName);</span>
        
<span class="fc bfc" id="L497" title="All 2 branches covered.">            if (helper.isPublic()) {</span>
<span class="fc" id="L498">                getCurrentProject().addToMeasurement(BasicMeasurements.PUBLIC_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L499">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PUBLIC_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L500">                getCurrentClass().addToMeasurement(BasicMeasurements.PUBLIC_INNER_CLASSES, innerClassName);</span>
<span class="fc bfc" id="L501" title="All 2 branches covered.">            } else if (helper.isPrivate()) {</span>
<span class="fc" id="L502">                getCurrentProject().addToMeasurement(BasicMeasurements.PRIVATE_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L503">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PRIVATE_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L504">                getCurrentClass().addToMeasurement(BasicMeasurements.PRIVATE_INNER_CLASSES, innerClassName);</span>
<span class="fc bfc" id="L505" title="All 2 branches covered.">            } else if (helper.isProtected()) {</span>
<span class="fc" id="L506">                getCurrentProject().addToMeasurement(BasicMeasurements.PROTECTED_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L507">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PROTECTED_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L508">                getCurrentClass().addToMeasurement(BasicMeasurements.PROTECTED_INNER_CLASSES, innerClassName);</span>
            } else {
<span class="fc" id="L510">                getCurrentProject().addToMeasurement(BasicMeasurements.PACKAGE_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L511">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.PACKAGE_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L512">                getCurrentClass().addToMeasurement(BasicMeasurements.PACKAGE_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L515" title="All 2 branches covered.">            if (helper.isStatic()) {</span>
<span class="fc" id="L516">                getCurrentProject().addToMeasurement(BasicMeasurements.STATIC_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L517">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.STATIC_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L518">                getCurrentClass().addToMeasurement(BasicMeasurements.STATIC_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L521" title="All 2 branches covered.">            if (helper.isFinal()) {</span>
<span class="fc" id="L522">                getCurrentProject().addToMeasurement(BasicMeasurements.FINAL_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L523">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.FINAL_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L524">                getCurrentClass().addToMeasurement(BasicMeasurements.FINAL_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L527" title="All 2 branches covered.">            if (helper.isInterface()) {</span>
<span class="fc" id="L528">                getCurrentProject().addToMeasurement(BasicMeasurements.INTERFACE_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L529">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.INTERFACE_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L530">                getCurrentClass().addToMeasurement(BasicMeasurements.INTERFACE_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L533" title="All 2 branches covered.">            if (helper.isAbstract()) {</span>
<span class="fc" id="L534">                getCurrentProject().addToMeasurement(BasicMeasurements.ABSTRACT_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L535">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.ABSTRACT_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L536">                getCurrentClass().addToMeasurement(BasicMeasurements.ABSTRACT_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L539" title="All 2 branches covered.">            if (helper.isSynthetic()) {</span>
<span class="fc" id="L540">                getCurrentProject().addToMeasurement(BasicMeasurements.SYNTHETIC_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L541">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.SYNTHETIC_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L542">                getCurrentClass().addToMeasurement(BasicMeasurements.SYNTHETIC_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L545" title="All 2 branches covered.">            if (helper.isAnnotation()) {</span>
<span class="fc" id="L546">                getCurrentProject().addToMeasurement(BasicMeasurements.ANNOTATION_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L547">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.ANNOTATION_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L548">                getCurrentClass().addToMeasurement(BasicMeasurements.ANNOTATION_INNER_CLASSES, innerClassName);</span>
            }

<span class="fc bfc" id="L551" title="All 2 branches covered.">            if (helper.isEnum()) {</span>
<span class="fc" id="L552">                getCurrentProject().addToMeasurement(BasicMeasurements.ENUM_INNER_CLASSES, innerClassName);</span>
<span class="fc" id="L553">                groups.forEach(group -&gt; group.addToMeasurement(BasicMeasurements.ENUM_INNER_CLASSES, innerClassName));</span>
<span class="fc" id="L554">                getCurrentClass().addToMeasurement(BasicMeasurements.ENUM_INNER_CLASSES, innerClassName);</span>
            }
        }
<span class="fc" id="L557">    }</span>

    // Package-level for testing
    boolean isInnerClassOfCurrentClass(InnerClass helper) {
        boolean result;

<span class="fc bfc" id="L563" title="All 2 branches covered.">        if (helper.hasOuterClassInfo()) {</span>
<span class="fc" id="L564">            result = helper.getOuterClassInfo().equals(getCurrentClass().getName());</span>
        } else {
<span class="fc" id="L566">            result = perl.match(&quot;/^&quot; + getCurrentClass().getName() + &quot;\\$\\d+$/&quot;, helper.getInnerClassInfo());</span>
        }

<span class="fc" id="L569">        return result;</span>
    }

    public void visitLineNumberTable_attribute(LineNumberTable_attribute attribute) {
<span class="fc" id="L573">        super.visitLineNumberTable_attribute(attribute);</span>

<span class="pc bpc" id="L575" title="1 of 2 branches missed.">        if (!attribute.getLineNumbers().isEmpty()) {</span>
<span class="fc" id="L576">            var minLineNumber = attribute.getLineNumbers().stream().map(LineNumber::getLineNumber).min(Integer::compareTo).orElse(0);</span>
<span class="fc" id="L577">            var maxLineNumber = attribute.getLineNumbers().stream().map(LineNumber::getLineNumber).max(Integer::compareTo).orElse(0);</span>

<span class="fc" id="L579">            getCurrentMethod().addToMeasurement(BasicMeasurements.RAW_METHOD_LENGTH, maxLineNumber - minLineNumber + 1);</span>
        }
<span class="fc" id="L581">    }</span>

    public void visitLineNumber(LineNumber helper) {
<span class="fc" id="L584">        sloc++;</span>
<span class="fc" id="L585">        getCurrentMethod().addToMeasurement(BasicMeasurements.EFFECTIVE_METHOD_LENGTH, 1);</span>
<span class="fc" id="L586">    }</span>

    public void visitLocalVariable(LocalVariable helper) {
<span class="fc" id="L589">        LogManager.getLogger(getClass()).debug(&quot;visitLocalVariable({})&quot;, helper::getName);</span>

<span class="fc" id="L591">        getCurrentMethod().addToMeasurement(BasicMeasurements.LOCAL_VARIABLES, helper.getName());</span>

<span class="fc" id="L593">        addClassDependencies(processDescriptor(helper.getDescriptor()));</span>
<span class="fc" id="L594">    }</span>

    private int computeDepthOfInheritance(Classfile classfile) {
<span class="fc" id="L597">        int result = 1;</span>
        
<span class="pc bpc" id="L599" title="1 of 4 branches missed.">        if (classfile != null &amp;&amp; classfile.hasSuperclass()) {</span>
<span class="fc" id="L600">            Classfile superclass = classfile.getLoader().getClassfile(classfile.getSuperclassName());</span>
<span class="fc" id="L601">            result += computeDepthOfInheritance(superclass);</span>
        }

<span class="fc" id="L604">        return result;</span>
    }
    
    private Collection&lt;String&gt; processDescriptor(String str) {
<span class="fc" id="L608">        Collection&lt;String&gt; result = new LinkedList&lt;&gt;();</span>
        
<span class="fc" id="L610">        LogManager.getLogger(getClass()).debug(&quot;processDescriptor(\&quot;{}\&quot;)&quot;, str);</span>

<span class="fc" id="L612">        int currentPos = 0;</span>
        int startPos;
        int endPos;

<span class="fc bfc" id="L616" title="All 2 branches covered.">        while ((startPos = str.indexOf('L', currentPos)) != -1) {</span>
<span class="pc bpc" id="L617" title="1 of 2 branches missed.">            if ((endPos = str.indexOf(';', startPos)) != -1) {</span>
<span class="fc" id="L618">                String classname = ClassNameHelper.path2ClassName(str.substring(startPos + 1, endPos));</span>
<span class="fc" id="L619">                result.add(classname);</span>
<span class="fc" id="L620">                currentPos = endPos + 1;</span>
<span class="fc" id="L621">            } else {</span>
<span class="nc" id="L622">                currentPos = startPos + 1;</span>
            }
        }

<span class="fc" id="L626">        LogManager.getLogger(getClass()).debug(&quot;    Parses to {}&quot;, result);</span>
        
<span class="fc" id="L628">        return result;</span>
    }

    private void addClassDependencies(Collection&lt;String&gt; classnames) {
<span class="fc" id="L632">        classnames.forEach(this::addClassDependency);</span>
<span class="fc" id="L633">    }</span>
    
    private void addClassDependency(String name) {
<span class="fc" id="L636">        LogManager.getLogger(getClass()).debug(&quot;addClassDependency(\&quot;{}\&quot;):&quot;, name);</span>

<span class="fc bfc" id="L638" title="All 4 branches covered.">        if (!getCurrentClass().getName().equals(name) &amp;&amp; isInFilter(name)) {</span>
<span class="fc" id="L639">            Metrics other = getMetricsFactory().createClassMetrics(name);</span>
                
<span class="fc bfc" id="L641" title="All 4 branches covered.">            if (getCurrentMethod() != null &amp;&amp; isInScope(getCurrentMethod().getName())) {</span>
<span class="fc" id="L642">                LogManager.getLogger(getClass()).debug(&quot;    add class dependency {} --&gt; {}&quot;, getCurrentMethod().getName(), name);</span>
                
<span class="fc bfc" id="L644" title="All 2 branches covered.">                if (getCurrentClass().getParent().equals(other.getParent())) {</span>
<span class="fc" id="L645">                    LogManager.getLogger(getClass()).debug(&quot;    Intra-Package!&quot;);</span>
<span class="fc" id="L646">                    getCurrentMethod().addToMeasurement(BasicMeasurements.OUTBOUND_INTRA_PACKAGE_CLASS_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L647">                    other.addToMeasurement(BasicMeasurements.INBOUND_INTRA_PACKAGE_METHOD_DEPENDENCIES, getCurrentMethod().getName());</span>
                } else {
<span class="fc" id="L649">                    LogManager.getLogger(getClass()).debug(&quot;    Extra-Package!&quot;);</span>
<span class="fc" id="L650">                    getCurrentMethod().addToMeasurement(BasicMeasurements.OUTBOUND_EXTRA_PACKAGE_CLASS_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L651">                    other.addToMeasurement(BasicMeasurements.INBOUND_EXTRA_PACKAGE_METHOD_DEPENDENCIES, getCurrentMethod().getName());</span>
                }
<span class="fc bfc" id="L653" title="All 2 branches covered.">            } else if (isInScope(getCurrentClass().getName())) {</span>
<span class="fc" id="L654">                LogManager.getLogger(getClass()).debug(&quot;    add class dependency {} --&gt; {}&quot;, getCurrentClass().getName(), name);</span>
                
<span class="fc bfc" id="L656" title="All 2 branches covered.">                if (getCurrentClass().getParent().equals(other.getParent())) {</span>
<span class="fc" id="L657">                    LogManager.getLogger(getClass()).debug(&quot;    Intra-Package!&quot;);</span>
<span class="fc" id="L658">                    getCurrentClass().addToMeasurement(BasicMeasurements.OUTBOUND_INTRA_PACKAGE_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L659">                    other.addToMeasurement(BasicMeasurements.INBOUND_INTRA_PACKAGE_DEPENDENCIES, getCurrentClass().getName());</span>
                } else {
<span class="fc" id="L661">                    LogManager.getLogger(getClass()).debug(&quot;    Extra-Package!&quot;);</span>
<span class="fc" id="L662">                    getCurrentClass().addToMeasurement(BasicMeasurements.OUTBOUND_EXTRA_PACKAGE_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L663">                    other.addToMeasurement(BasicMeasurements.INBOUND_EXTRA_PACKAGE_DEPENDENCIES, getCurrentClass().getName());</span>
                }
            } else {
<span class="fc" id="L666">                LogManager.getLogger(getClass()).debug(&quot;    skipping class dependency {} --&gt; {}&quot;, getCurrentClass().getName(), name);</span>
            }
<span class="fc" id="L668">        } else {</span>
<span class="fc" id="L669">            LogManager.getLogger(getClass()).debug(&quot;    skipping class dependency {} --&gt; {}&quot;, getCurrentClass().getName(), name);</span>
        }
<span class="fc" id="L671">    }</span>
    
    private void addMethodDependency(String name) {
<span class="fc" id="L674">        LogManager.getLogger(getClass()).debug(&quot;addMethodDependency(\&quot;{}\&quot;):&quot;, name);</span>

<span class="pc bpc" id="L676" title="1 of 6 branches missed.">        if (!getCurrentMethod().getName().equals(name) &amp;&amp; isInScope(getCurrentMethod().getName()) &amp;&amp; isInFilter(name)) {</span>
<span class="fc" id="L677">            LogManager.getLogger(getClass()).debug(&quot;    add method dependency {} --&gt; {}&quot;, getCurrentMethod().getName(), name);</span>
<span class="fc" id="L678">            Metrics other = getMetricsFactory().createMethodMetrics(name);</span>
            
<span class="fc bfc" id="L680" title="All 2 branches covered.">            if (getCurrentClass().equals(other.getParent())) {</span>
<span class="fc" id="L681">                LogManager.getLogger(getClass()).debug(&quot;    Intra-Class!&quot;);</span>
<span class="fc" id="L682">                getCurrentMethod().addToMeasurement(BasicMeasurements.OUTBOUND_INTRA_CLASS_FEATURE_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L683">                other.addToMeasurement(BasicMeasurements.INBOUND_INTRA_CLASS_METHOD_DEPENDENCIES, getCurrentMethod().getName());</span>
<span class="fc bfc" id="L684" title="All 2 branches covered.">            } else if (getCurrentGroup().equals(other.getParent().getParent())) {</span>
<span class="fc" id="L685">                LogManager.getLogger(getClass()).debug(&quot;    Intra-Package!&quot;);</span>
<span class="fc" id="L686">                getCurrentMethod().addToMeasurement(BasicMeasurements.OUTBOUND_INTRA_PACKAGE_FEATURE_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L687">                other.addToMeasurement(BasicMeasurements.INBOUND_INTRA_PACKAGE_METHOD_DEPENDENCIES, getCurrentMethod().getName());</span>
            } else {
<span class="fc" id="L689">                LogManager.getLogger(getClass()).debug(&quot;    Extra-Package!&quot;);</span>
<span class="fc" id="L690">                getCurrentMethod().addToMeasurement(BasicMeasurements.OUTBOUND_EXTRA_PACKAGE_FEATURE_DEPENDENCIES, other.getName());</span>
<span class="fc" id="L691">                other.addToMeasurement(BasicMeasurements.INBOUND_EXTRA_PACKAGE_METHOD_DEPENDENCIES, getCurrentMethod().getName());</span>
            }
<span class="fc" id="L693">        } else {</span>
<span class="fc" id="L694">            LogManager.getLogger(getClass()).debug(&quot;    skipping method dependency {} --&gt; {}&quot;, getCurrentMethod().getName(), name);</span>
        }
<span class="fc" id="L696">    }</span>
    
    private boolean isInScope(String name) {
<span class="fc" id="L699">        boolean result = true;</span>

<span class="fc bfc" id="L701" title="All 2 branches covered.">        if (scope != null) {</span>
<span class="fc" id="L702">            result = scope.contains(name);</span>
        }

<span class="fc" id="L705">        return result;</span>
    }
    
    private boolean isInFilter(String name) {
<span class="fc" id="L709">        boolean result = true;</span>

<span class="fc bfc" id="L711" title="All 2 branches covered.">        if (filter != null) {</span>
<span class="fc" id="L712">            result = filter.contains(name);</span>
        }

<span class="fc" id="L715">        return result;</span>
    }

    public void addMetricsListener(MetricsListener listener) {
<span class="fc" id="L719">        metricsListeners.add(listener);</span>
<span class="fc" id="L720">    }</span>

    public void removeMetricsListener(MetricsListener listener) {
<span class="nc" id="L723">        metricsListeners.remove(listener);</span>
<span class="nc" id="L724">    }</span>

    protected void fireBeginSession(int size) {
<span class="fc" id="L727">        MetricsEvent event = new MetricsEvent(this, size);</span>
<span class="fc" id="L728">        metricsListeners.forEach(listener -&gt; listener.beginSession(event));</span>
<span class="fc" id="L729">    }</span>

    protected void fireBeginClass(Classfile classfile) {
<span class="fc" id="L732">        MetricsEvent event = new MetricsEvent(this, classfile);</span>
<span class="fc" id="L733">        metricsListeners.forEach(listener -&gt; listener.beginClass(event));</span>
<span class="fc" id="L734">    }</span>

    protected void fireBeginMethod(Method_info method) {
<span class="fc" id="L737">        MetricsEvent event = new MetricsEvent(this, method);</span>
<span class="fc" id="L738">        metricsListeners.forEach(listener -&gt; listener.beginMethod(event));</span>
<span class="fc" id="L739">    }</span>

    protected void fireEndMethod(Method_info method, Metrics metrics) {
<span class="fc" id="L742">        MetricsEvent event = new MetricsEvent(this, method, metrics);</span>
<span class="fc" id="L743">        metricsListeners.forEach(listener -&gt; listener.endMethod(event));</span>
<span class="fc" id="L744">    }</span>

    protected void fireEndClass(Classfile classfile, Metrics metrics) {
<span class="fc" id="L747">        MetricsEvent event = new MetricsEvent(this, classfile, metrics);</span>
<span class="fc" id="L748">        metricsListeners.forEach(listener -&gt; listener.endClass(event));</span>
<span class="fc" id="L749">    }</span>

    protected void fireEndSession() {
<span class="fc" id="L752">        MetricsEvent event = new MetricsEvent(this);</span>
<span class="fc" id="L753">        metricsListeners.forEach(listener -&gt; listener.endSession(event));</span>
<span class="fc" id="L754">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>